"use strict";var margin={top:20,right:140,bottom:60,left:60},w=parseInt(d3.select("#scatter-div").style("width"),10),w=w-margin.left-margin.right,h=parseInt(d3.select("#scatter-div").style("height"),10),h=h-margin.top-margin.bottom,canvasPadding={top:10,right:10,bottom:10,left:60},textShift=0,dotsShiftX=0,dotsShiftY=0,xaxisShiftX=60,yaxisShiftX=50,xaxisShiftY=-50,yaxisShiftY=0,infoTop=115,infoLeft=w+margin.left,infoWidth="13em",infoHeight="26.65em";d3.csv("production_data/world_data/datadev/world.csv",function(error,data){error?console.log(error):console.log(data);var worldData=data,key=function(t,e){return t.country},dataX=function(t){return+t.polistab},dataY=function(t){return+t.press},dataR=function(t){return+t.gdphead};console.log(dataX.toString());var titleX="Political Stabtility",titleY="Press Freedom",titleR="GDP per Capita",citeX="An index from -2.5 to 2.5, 2.5 being the most stable, sourced from the Word Bank's <a href='http://databank.worldbank.org/data/reports.aspx?source=world-development-indicators' target='_blank'>World development indicators</a>.",citeY="An annual rating of press freedom at the country level, 1 being the most free, 100 being the least. Sourced from <a href='https://.org/en/ranking' target='_blank'>Reporters Without Borders</a>.",titleText=d3.select("h3#chart-subhead").append("text").attr("class","title-text").text(titleX+" vs. "+titleY+", dots sized by GDP per capita."),dotTips=d3.tip().attr("class","d3-tip").style({top:infoTop,left:infoLeft,width:infoWidth,"background-color":"transparent",opacity:0}).direction("e").html(function(t){return"<p id='tiphead'>"+t.country+"</p><p id='region'>"+t.region+"</span></p><p>"+titleX+"<p class='tip-value'>"+dataX(t)+"</p><p>"+titleY+"</p><p class='tip-value'>"+dataY(t)+"</p><div id='citation'><div class='citation-title'>"+titleX+"</div><br />"+citeX+"<br /><br /><div class='citation-title'>"+titleY+"</div><br />"+citeY+"</div>"}),svg=d3.select("#scatter-div").append("svg").attr({width:w+margin.left+margin.right,height:h+margin.top+margin.bottom,id:"canvas"}).append("g").attr({transform:"translate("+margin.left+","+margin.top+")"}),xScale=d3.scale.linear().domain([d3.min(worldData,function(t){return dataX(t)}),d3.max(worldData,function(t){return dataX(t)})]).range([xaxisShiftX,w]).nice(),yScale=d3.scale.linear().domain([d3.max(worldData,function(t){return dataY(t)}),d3.min(worldData,function(t){return dataY(t)})]).range([0,h+xaxisShiftY]).nice(),rScale=d3.scale.linear().domain([0,d3.max(worldData,function(t){return dataR(t)})]).range([4,40]).nice(),colorScale=d3.scale.ordinal().domain(["Low","Lower Middle","Upper Middle","High, Non-OECD","High, OECD"]).range(["#991766","#D90F5A","#F34739","#FF6E27","#FFB627"]),xAxis=d3.svg.axis().scale(xScale).orient("bottom"),yAxis=d3.svg.axis().scale(yScale).orient("left"),guideLines=function(t){svg.append("g").classed("guide",!0).append("line").attr("y1",d3.select(".a-dot").attr("cy")).attr("y2",d3.select(".a-dot").attr("cy")).attr("x1",yaxisShiftX).attr("x2",d3.select(".a-dot").attr("cx")).attr("stroke",d3.select(".a-dot").attr("fill")),svg.append("g").classed("guide",!0).append("line").attr("y1",h+xaxisShiftY).attr("y2",d3.select(".a-dot").attr("cy")).attr("x1",d3.select(".a-dot").attr("cx")).attr("x2",d3.select(".a-dot").attr("cx")).attr("stroke",d3.select(".a-dot").attr("fill"))},mouseOn=function(){d3.select(this).attr("opacity",1).classed("a-dot",!0).classed("dots",!1),guideLines(),d3.select(".d3-tip").style("background-color",d3.select(".a-dot").attr("fill")).style("color",d3.select(".a-dot").attr("stroke")).style("opacity",.5),d3.selectAll("circle.dots").filter(function(t){return isNaN(dataX(t))}).attr({opacity:0,"pointer-events":"none"}).attr("opacity",.15)},mouseOff=function(){d3.select(this).classed("a-dot",!1).classed("dots",!0),d3.selectAll(".guide").remove(),d3.selectAll("circle.dots").filter(function(t){return isNaN(dataX(t))}).attr({opacity:0,"pointer-events":"none"}).attr("opacity",.85)},dotsGroup=svg.append("g").attr({id:"dots-group"}),dotsFilter=dotsGroup.append("defs").append("filter").attr({id:"dots-filter",x:0,y:0,width:"200%",height:"200%"}),shadowOffset=dotsFilter.append("feOffset").attr({result:"offOut",in:"SourceGraphic",dx:20,dy:20}),shadowBlend=dotsFilter.append("feBlend").attr({in:"SourceGraphic",in2:"offOut",mode:"normal"}),dots=d3.select("#dots-group").selectAll("circle").data(worldData,key).enter().append("circle").filter(function(t){return dataX(t)}).filter(function(t){return dataY(t)}).filter(function(t){return dataR(t)}).attr({class:"dots",id:function(t){return t.country},cx:function(t){return xScale(dataX(t))},cy:function(t){return yScale(dataY(t))},r:function(t){return rScale(dataR(t))},"pointer-events":"all",fill:function(t){return"High income: nonOECD"==t.ig?"#FF6E27":"Low income"==t.ig?"#991766":"Upper middle income"==t.ig?"#F34739":"Lower middle income"==t.ig?"#D90F5A":"High income: OECD"==t.ig?"#FFB627":"black"},stroke:function(t){return"High income: nonOECD"==t.ig?"#1A1F1E":"Low income"==t.ig?"#c5c1b9":"Upper middle income"==t.ig?"#1A1F1E":"Lower middle income"==t.ig?"#1A1F1E":"High income: OECD"==t.ig?"#1A1F1E":"black"},"stroke-width":0,opacity:.85}).style({}).call(dotTips).on("mouseenter",dotTips.show).on("mouseover",mouseOn).on("mouseleave",dotTips.hide).on("mouseout",mouseOff);d3.selectAll("circle.dots").filter(function(t){return"number"!=typeof dataX(t)}).remove(),svg.append("g").attr({class:"xaxis",transform:"translate(0,"+(h+xaxisShiftY)+")"}).call(xAxis);var xLabel=svg.append("text").attr({class:"x-label","text-anchor":"middle",transform:function(t){return"translate("+w/2+","+h+")"}}).text(titleX);svg.append("g").attr({class:"yaxis",transform:"translate("+yaxisShiftX+",0)"}).call(yAxis);var yLabel=svg.append("text").attr({class:"y-label","text-anchor":"middle",transform:function(t){return"translate(10,"+(h+xaxisShiftY)/2+") rotate(-90)"}}).text(titleY);d3.selectAll(".x-choice").on("click",function(){var xValue=d3.select(this).attr("value");console.log(xValue);var dataX=function(d){return eval(xValue)};switch(xValue){case"+d.gini":titleX="Gini Index",citeX="A measure of country level inequality, with 1 being the most unequal sourced from the World Bank's <a href='https://data.worldbank.org/indicator/SI.POV.GINI' target='_blank'>World Development Indicators</a>.";break;case"+d.press":titleX="Press Freedom",citeX="An annual rating of press freedom at the country level, 1 being the most free, 100 being the least. Sourced from <a href='https://.org/en/ranking' target='_blank'>Reporters Without Borders</a>.";break;case"+d.mfr":titleX="Population, % Female",citeX="Sourced from the World Bank's <a href='https://data.worldbank.org/indicator/SP.POP.TOTL.FE.ZS' target='_blank'>World Development Indicators</a>.";break;case"+d.life_exp":titleX="Life Expectancy",citeX="Life expectancy in years sourced from the World Bank's <a href='https://data.worldbank.org/indicator/SP.DYN.LE00.IN' target='_blank'>World Development Indicators</a>.";break;case"+d.gre":titleX="Female enrollment ratio",citeX="Total enrollment as a percent of the female population, adjusted for age grou. Sourced from the World Bank's <a href='https://data.worldbank.org/indicator/SE.SEC.ENRR.FE' target='_blank'>World Development Indicators</a>.";break;case"+d.corruption":titleX="Control of Corruption",citeX="An index from -2.5 to 2.5, 2.5 being the most stable, sourced from the Word Bank's <a href='http://databank.worldbank.org/data/databases/control-of-corruption' target='_blank'>World development indicators</a>.";break;case"+d.polistab":titleX="Political Stability",citeX="An index from -2.5 to 2.5, 2.5 being the most stable, sourced from the Word Bank's <a href='http://databank.worldbank.org/data/reports.aspx?source=world-development-indicators' target='_blank'>World development indicators</a>.";break;case"+d.gdphead":titleX="GDP per Capita",citeX="GDP / Total Population, sourced from the World Bank's <a href='https://data.worldbank.org/indicator/NY.GDP.PCAP.CD' target='_blank'>World Development Indicators</a>."}var xScale=d3.scale.linear().domain([d3.min(worldData,function(t){return dataX(t)}),d3.max(worldData,function(t){return dataX(t)})]).range([xaxisShiftX,w]).nice();d3.select("#dots-group").selectAll("circle").filter(function(t){return dataX(t)}).transition().duration(1e3).attr({cx:function(t){return xScale(dataX(t))},opacity:.85,"pointer-events":"all"}),d3.selectAll("circle.dots").filter(function(t){return isNaN(dataX(t))}).transition().duration(1e3).attr({opacity:0,"pointer-events":"none"});var xAxis=d3.svg.axis().scale(xScale).orient("bottom");xLabel.text(titleX),titleText.text(titleX+" vs. "+titleY),d3.select(".xaxis").transition().duration(1e3).call(xAxis),dotTips.html(function(t){return"<p id='tiphead'>"+t.country+"</p><p id='region'>"+t.region+"</span></p><p>"+titleX+"<p class='tip-value'>"+dataX(t)+"</p><p>"+titleY+"</p><p class='tip-value'>"+dataY(t)+"</p><div id='citation'><div class='citation-title'>"+titleX+"</div><br />"+citeX+"<br /><br /><div class='citation-title'>"+titleY+"</div><br />"+citeY+"</div>"})}),d3.selectAll(".y-choice").on("click",function(){var yValue=d3.select(this).attr("value");console.log(yValue);var dataY=function(d){return eval(yValue)};switch(yValue){case"+d.gini":titleY="Gini Index",citeY="A measure of country level inequality, with 1 being the most unequal sourced from the World Bank's <a href='https://data.worldbank.org/indicator/SI.POV.GINI' target='_blank'>World Development Indicators</a>.";break;case"+d.press":titleY="Press Freedom",citeY="An annual rating of press freedom at the country level, 1 being the most free, 100 being the least. Sourced from <a href='https://.org/en/ranking' target='_blank'>Reporters Without Borders</a>.";break;case"+d.mfr":titleY="Population, % Female",citeY="Sourced from the World Bank's <a href='https://data.worldbank.org/indicator/SP.POP.TOTL.FE.ZS' target='_blank'>World Development Indicators</a>.";break;case"+d.life_exp":titleY="Life Expectancy",citeY="Life expectancy in years sourced from the World Bank's <a href='https://data.worldbank.org/indicator/SP.DYN.LE00.IN' target='_blank'>World Development Indicators</a>.";break;case"+d.gre":titleY="Female enrollment ratio",citeY="Total enrollment as a percent of the female population, adjusted for age grou. Sourced from the World Bank's <a href='https://data.worldbank.org/indicator/SE.SEC.ENRR.FE' target='_blank'>World Development Indicators</a>.";break;case"+d.corruption":titleY="Control of Corruption",citeY="An index from -2.5 to 2.5, 2.5 being the most stable, sourced from the Word Bank's <a href='http://databank.worldbank.org/data/databases/control-of-corruption' target='_blank'>World development indicators</a>.";break;case"+d.polistab":titleY="Political Stability",citeY="An index from -2.5 to 2.5, 2.5 being the most stable, sourced from the Word Bank's <a href='http://databank.worldbank.org/data/reports.aspx?source=world-development-indicators' target='_blank'>World development indicators</a>.";break;case"+d.gdphead":titleY="GDP per Capita",citeY="GDP / Total Population, sourced from the World Bank's <a href='https://data.worldbank.org/indicator/NY.GDP.PCAP.CD' target='_blank'>World Development Indicators</a>."}var yScale=d3.scale.linear().domain([d3.max(worldData,function(t){return dataY(t)}),d3.min(worldData,function(t){return dataY(t)})]).range([0,h+xaxisShiftY]).nice();d3.select("#dots-group").selectAll("circle").filter(function(t){return dataY(t)}).transition().duration(1e3).attr({cy:function(t){return yScale(dataY(t))},opacity:.85,"pointer-events":"all"}),d3.selectAll("circle.dots").filter(function(t){return isNaN(dataY(t))}).transition().duration(1e3).attr({opacity:0,"pointer-events":"none"});var yAxis=d3.svg.axis().scale(yScale).orient("left");yLabel.text(titleY),titleText.text(titleX+" vs. "+titleY),d3.select(".yaxis").transition().duration(1e3).call(yAxis),dotTips.html(function(t){return"<p id='tiphead'>"+t.country+"</p><p id='region'>"+t.region+"</span></p><p>"+titleX+"<p class='tip-value'>"+dataX(t)+"</p><p>"+titleY+"</p><p class='tip-value'>"+dataY(t)+"</p><div id='citation'><div class='citation-title'>"+titleX+"</div><br />"+citeX+"<br /><br /><div class='citation-title'>"+titleY+"</div><br />"+citeY+"</div>"})})});